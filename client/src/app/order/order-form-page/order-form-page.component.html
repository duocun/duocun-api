<div class="loading-spinner" *ngIf="loading">
  <app-progress-spinner></app-progress-spinner>
</div>

<div class="page" *ngIf="!loading">
  <div class="title-block">
    <span class="title-bg" i18n="@@ConfirmOrder">Confirm Order</span>
  </div>

  <form [formGroup]="form" id="order-form">
    <div class="contact-block" *ngIf="account" (click)="changeContact()">
      <div class="title-md">
        <div class="label">
          <span i18n="@@DeliveryTime">Delivery Time</span>:
        </div>
        <span class="date">{{ delivery.date | date: 'yyyy-MM-dd'}} </span>
        <span class="time">11:45~13:00</span>
        <!-- <span class="time">{{delivery.date.toDate() | date: 'HH:mm'}}~{{delivery.toTime | date: 'HH:mm'}} </span> -->
      </div>
      <div class="title-md">
        <div class="label">
          <span i18n="@@DeliverTo">Deliver to</span>:
        </div>
        <span class="user-col">{{account.username}}</span>
        <span class="phone-col" *ngIf="account && account.phone">{{account.phone}}</span>
      </div>
      <div class="title-md">
        <div class="label">
          <span i18n="@@DeliveryAddress">Delivery Addr</span>:
        </div>
        <span class="address-text">{{address}}</span>
      </div>
      <!-- <div>Estimate: 11:45~1:45</div> -->
    </div>

    <div class="title-md restaurant" *ngIf="cart.merchantName">{{cart.merchantName}}</div>

    <div class="row order-detail" *ngIf="cart">
      <div class="col-7 items-col">
        <div *ngFor="let item of cart.items" class="text-sm row item-row">
          <div class="col-8 product-col">{{item.productName}}</div>
          <div class="col-2 quantity-col">x{{item.quantity}}</div>
          <div class="col-2 price-col">${{item.price | number : '1.2-2'}}</div>
        </div>
      </div>
      <div class="col-5 text-sm total-col" *ngIf="charge">
        <div class="row">
          <div class="col-12">
            <div class="title-xs">
              <span i18n="@@ProductTotal">Product Total</span>:</div>
            <div class="text-xs">&nbsp;${{charge.price | number : '1.2-2'}}</div>
          </div>
          <div class="col-12">
            <div class="title-xs">
              <span i18n="@@DeliveryFee">Delivery Fee</span>:</div>
            <div class="text-xs">&nbsp;${{charge.deliveryCost | number : '1.2-2'}}</div>
          </div>
          <div class="col-12">
            <div class="title-xs">
              <span i18n="@@Subtotal">Subtotal</span>:</div>
            <div class="text-xs">&nbsp;${{charge.price + charge.deliveryCost | number : '1.2-2'}}</div>
          </div>
          <div class="col-12">
            <div class="title-xs">
              <span i18n="@@Tax">Tax</span>:</div>
            <div class="text-xs">&nbsp;${{charge.tax | number : '1.2-2'}}</div>
          </div>
          <div class="col-12">
            <div class="title-xs">
              <span i18n="@@Tips">Tips</span>:</div>
            <div class="text-xs">&nbsp;${{charge.tips | number : '1.2-2'}}</div>
          </div>
          <div class="col-12">
            <div class="title-xs">
              <span i18n="@@DeliveryDiscount">Discount</span>:</div>
            <div class="text-xs">&nbsp;${{charge.deliveryDiscount | number : '1.2-2'}}</div>
          </div>
          <div class="col-12" *ngIf="charge.groupDiscount>0">
            <div class="title-xs">
              <span i18n="@@GroupDiscount">GroupDiscount</span>:</div>
            <div class="text-xs">&nbsp;${{charge.groupDiscount | number : '1.2-2'}}</div>
          </div>

          <div class="col-12" *ngIf="charge.overRangeCharge>0">
            <div class="title-xs">
              <span i18n="@@OverRangeCharge">Over Range Fee</span>:</div>
            <div class="text-xs">&nbsp;${{charge.overRangeCharge | number : '1.2-2'}}</div>
          </div>

          <div class="col-12 total-row">
            <div class="title-xs">
              <span i18n="@@Total">Total</span>:</div>
            <div class="text-xs">&nbsp;${{ charge.total | number : '1.2-2'}}</div>
          </div>

          <div class="col-12" *ngIf="charge && balance!=0">
            <div class="title-xs">
              <span i18n="@@CurrentBalance">Balance</span>:</div>
            <div class="text-xs">&nbsp;${{ balance | number : '1.2-2'}}</div>
          </div>

          <div class="col-12 total-row" *ngIf="charge && balance!=0">
            <div class="title-xs">
              <span i18n="@@TotalPayable">Payable</span>:</div>
            <div class="text-xs">&nbsp;${{ balance >= charge.total ? 0 : charge.total - balance | number : '1.2-2'}}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- <div class="group-order-block" *ngIf="charge && productTotal < 20">
      <div class="row label-sm">
        <span>拼单优惠（同一配送时段内，同一地址有不同账号下的订单)</span>
      </div>
      <div class="row">拼单每单劲减$2！优惠后只要
        <span class="red-text">${{ afterGroupDiscount | number : '1.2-2'}}</span>
      </div>
    </div> -->
    <div class="payment-method-block">
      <div class="row label-sm">
        <span i18n="@@PaymentMethod">Payment Method</span>:
      </div>
      <!-- <input name="paymentMethod" readonly /> -->
      <div *ngIf="charge && balance >= charge.total" i18n="@@PayByDeposit">Pay by my deposit</div>
      <!-- <div class="title" i18n="@@CashWhenDelivered" *ngIf="balance && charge && balance.amount < charge.total">Cash when Delivered</div> -->


      <app-payment-select [selected]="paymentMethod" (select)="onSelectPaymentMethod($event)"></app-payment-select>

      <!-- <mat-button-toggle-group *ngIf="charge && balance < charge.total" #group="matButtonToggleGroup" [value]="paymentMethod" (change)="onSelectPaymentMethod($event)">
        <mat-button-toggle value="cash" aria-label="Cash">
          <div class="payment-icon">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
              <path [style.fill]="getIconColor('cash')" d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          </div>
          <div class="title" i18n="@@Cash">Cash</div>
        </mat-button-toggle>

        <mat-button-toggle value="WECHATPAY" aria-label="Wechat" *ngIf="lang==='zh'">
          <div>
            <svg class="icon" viewBox="0 0 1144 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1142" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><defs><style type="text/css"></style></defs>
              <path [style.fill]="getIconColor('WECHATPAY')" d="M436.314353 632.771765c-68.517647 36.321882-78.667294-20.389647-78.667294-20.389647l-85.835294-190.524236c-33.039059-90.533647 28.581647-40.839529 28.581647-40.839529s52.856471 38.038588 93.003294 61.229176c40.086588 23.190588 85.835294 6.806588 85.835294 6.806589l561.212235-246.362353C936.899765 80.112941 765.891765 0 572.235294 0 256.180706 0 0 213.232941 0 476.310588c0 151.311059 84.811294 285.967059 216.937412 373.248l-23.792941 130.288941s-11.625412 38.038588 28.611764 20.389647c27.437176-12.047059 97.370353-55.115294 138.992941-81.347764 65.445647 21.684706 136.734118 33.731765 211.486118 33.731764 316.024471 0 572.235294-213.232941 572.235294-476.310588 0-76.197647-21.594353-148.178824-59.843764-212.028235-178.808471 102.309647-594.733176 340.118588-648.312471 368.489412z" p-id="1143"></path>
            </svg>
          </div>
          <div class="title">微信支付</div>
        </mat-button-toggle>
        <mat-button-toggle value="card" aria-label="Card">
          <div class="payment-icon">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/>
            <path [style.fill]="getIconColor('card')" d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
          </div>
          <div class="title" i18n="@@CreditCard">Credit/Debit Card</div>
        </mat-button-toggle>
      </mat-button-toggle-group> -->

      <div class="cash-note" *ngIf="paymentMethod==='cash'" i18n="@@PayCashNote">*Pay in cash upon delivery</div>
      <form id="payment-form" onsubmit="return false;" *ngIf="paymentMethod==='card' && balance < charge.total">
        <div class="form-row" >
          <label for="card-element" class="label-sm" i18n="@@CreditCard">Credit/Debit Card:</label>
          <div id="card-element">
            <!-- A Stripe Element will be inserted here. action="/charge" method="post" *ngIf="account && account.verified" -->
          </div>

          <!-- Used to display Element errors. -->
          <div id="card-errors" role="alert"></div>
        </div>

        <!-- <button (click)="onSubmit()">Submit Payment</button> -->
      </form>
    </div>

    <div class="row warning-block">
      <div class="label-sm text-warning" i18n="@@DeliverWarning">*If you are in condo or office building, Please pickup at the hall, we will not enter the building. In Downtown, our car will stop at the road side near the building.
      </div>
      <div class="label-sm text-warning" i18n="@@PhoneWarning">**Please turn on your phone to answering status.
      </div>
    </div>

    <div class="notes-block">
      <div class="row label-sm">
        <span i18n="@@Notes">Notes</span>:
      </div>
      <div class="row">
        <textarea name="note" formControlName="note"></textarea>
      </div>
    </div>
  </form>


</div>